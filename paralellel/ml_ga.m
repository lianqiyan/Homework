clear;clc;
% 适应度函数
% f = @(x) -20*exp(-0.2*sqrt((x(1)^2+x(2)^2)/2))-exp((cos(2*pi*x(1))+cos(2*pi*x(2)))/2)+22.71289;
f = @(x) (1-x(1))^2 + 100*(x(2) - x(1)^2)^2;
% f = @(x) 1 + (1/4000)*(x(1)^2 +x(2)^2) - cos(x(1))*cos(x(2)/sqrt(2));


%'crossoverscattered'
%'crossoversinglepoint'
% 'crossovertwopoint'
%{@crossoverintermediate, 0.95}

% , 'PlotFcn', @gaplotbestf
% {@mutationgaussian,1,.5}
% mutationuniform

load init
options = optimoptions('ga','MutationFcn',{@mutationuniform,0.8},'CrossoverFcn', {@crossoversinglepoint},...
    'PopulationSize',100, 'MaxStallGenerations',200);
options.InitialPopulationMatrix = init;
y = zeros(10,1);
f_x = zeros(10, 2);
for i = 1:10
[f_x(i,:),y(i),~,~,~,~] = ga(f,2,[],[],[],[],[],[],[],[],options);
end

%%  Rosenbrock Function
x = -2:0.1:2;
y = x;
[x, y] = meshgrid(x,y);
z = (1 - x)^2 + 100*(y - x.^2).^2;
mesh(x,y,z)
hold on
scatter3(1,1,1,'r','filled');
text(1,1,400,'\bf Optimal')
title('Rosenbrock Function')
%% Griewank Function
x = -20:0.3:20;
y = x;
[x, y] = meshgrid(x ,y);
z = 1 + (1/4000)*(x.^2 + y.^2) - cos(x).*cos(y/sqrt(2));
mesh(x,y,z)
%%
data = [0.11748408	0.490199689	2.636177236
0.256119312	3.138587353	0.783479425
2.795039015	0.66571954	8.655860525
13.69651519	0.554855619	2.571194688
0.071494211	1.347657771	12.24269335
0.209261604	1.615649478	0.825616847
7.755290236	0.304861068	0.271383466
0.23644388	0.301498072	0.053672968
1.008271774	0.000110519	0.344668272
1.478112758	1.209851374	0.051699659];
for i = 1:3
    hold on
    scatter(i+0.02*rand(10,1), data(:, i));
    text(i-0.3, min(data(:, i)) - 0.8, ['平均最优值为', num2str(mean(data(:, i)))]);
end
boxplot(data,'Labels',{'crossoverscattered','crossoversinglepoint', 'crossovertwopoint'});
ylabel('fitness')
title('不同交叉策略对GA的影响')
%%
data = [1.684166661	0.372645323
16.31103974	0.103134402
3.109580209	0.023371579
0.083373512	0.043297297
3.523384171	0.117786505
0.150484345	0.046802801
22.28539056	0.537039863
11.39485315	0.034109002
1.978609864	0.076969103
0.31620725	0.201850724];
for i = 1:2
    hold on
    scatter(i+0.02*rand(10,1), data(:, i));
    text(i-0.3, min(data(:, i)) - 0.8, ['平均最优值为', num2str(mean(data(:, i)))]);
end
boxplot(data,'Labels',{'mutation rate 0.1','mutation rate 0.8'});
ylabel('fitness')
title('不同变异策略对GA的影响')
%%
clear;clc;
data = [2223	2277	2307	2351	2248
2265	2285	2225	2290	2277
2274	2265	2220	2286	2301
2260	2303	2280	2297	2332
2303	2321	2222	2210	2248
2333	2240	2243	2288	2325
2238	2349	2281	2313	2265
2203	2210	2314	2294	2351
2236	2295	2261	2350	2293
2435	2234	2245	2335	2300];
d_mean = mean(data);
d_min = min(data);
iter = 1000:1000:5000;
hold on
plot(iter, d_mean)
plot(iter, d_min)

scatter(iter, d_mean);
scatter(iter,d_min,'k')
legend('平均完工时间','最短完工时间')
for i = 1:5
    text(iter(i), d_mean(i) + 5, num2str(d_mean(i)));
    text(iter(i), d_min(i) + 5, num2str(d_min(i)));
end
title('串行遗传算法实验结果')
xlabel('GA迭代次数')
ylabel('工件完成时间')

xticks(iter)
xticklabels({'1000','2000','3000','4000','5000'})
%%
clear;clc;
data=[2277	2174	2350	2374
2174	2175	2175	2175
2171	2175	2157	2171
2142	2159	2158	2147
2095	2133	2149	2157
2095	2095	2099	2073
2087	2063	2090	2073
2063	2073	2073	2073
2063	2085	2072	2073
2063	2063	2072	2072
2060	2063	2091	2064
2060	2063	2060	2063
2057	2060	2063	2055
2057	2055	2057	2063
2057	2055	2057	2073
2055	2055	2055	2057
2055	2055	2064	2055
2055	2055	2078	2031
2031	2033	2031	2031
2031	2031	2031	2026
2031	2051	2031	2031
2031	2033	2031	2033
2031	2031	2031	2023
2023	2023	2031	2023
2021	2023	2031	2023
2018	2021	2023	2021
2018	2021	2017	2018
2018	2018	2018	2018
2018	2018	2035	2026
2007	2018	2049	2022
2007	2018	2025	2018
2007	2004	2018	2007
1976	2007	2001	1994
1976	1976	2010	1976
1976	1976	2010	1976
1976	1968	1974	1976
1968	1968	2005	1964
1964	1959	1968	1968
1964	1968	1968	1964
1964	1964	1964	1964
1964	1964	1964	1964
1964	1964	1964	1959
1959	1959	1964	1964
1959	1964	1959	1959
1959	1959	1959	1959
1959	1959	1986	1959
1959	1959	1959	1959
1959	1955	1959	1959
1955	1959	1955	1959
1955	1959	1955	1955
1955	1959	1959	1960
1955	1959	1959	1959
1955	1956	1960	1955
1955	1955	1956	1959
1955	1956	1990	1955
1955	1955	1996	1955
1955	1955	1996	1955
1955	1955	1987	1955
1955	1955	1987	1955
1955	1955	1955	1955
1955	1955	1959	1955
1955	1959	1959	1955
1955	1959	1959	1958
1955	1959	1959	1959
1955	1959	1955	1959
1955	1959	1955	1955
1955	1955	1959	1955
1955	1955	1955	1955
1955	1955	1996	1955
1955	1955	1994	1955
1955	1955	1986	1955
1955	1955	1986	1955
1955	1955	1955	1955
1955	1955	1955	1955
1955	1955	1955	1955
1955	1955	1971	1955
1955	1955	1984	1984
1955	1955	1986	1955
1955	1955	1955	1947
1955	1947	1954	1955
1954	1954	1955	1947
1947	1954	1961	1955
1947	1955	1955	1955
1947	1947	1955	1955
1947	1947	1992	1947
1947	1947	1976	1947
1947	1935	1947	1961
1935	1947	1947	1947
1935	1935	1947	1947
1935	1935	1947	1935
1935	1935	1947	1935
1935	1935	1935	1935
1935	1935	1947	1935
1935	1935	1939	1935
1935	1935	1954	1935
1935	1935	1935	1935
1935	1935	1935	1935
1935	1935	1935	1947
1935	1935	1947	1944
1935	1935	1957	1957];
hold on
for i = 1:4
    plot(data(:, i));
end
text(75, min(data(:)) + 80, ['最短完工时间为', num2str(min(data(:)))]);
legend('Thread1','Thread2','Thread3','Thread4')
title('并行遗传算法实验结果')
xlabel('并行GA种群交流次数')
ylabel('工件完成时间')